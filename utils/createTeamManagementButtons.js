const { Markup } = require('telegraf');
const { checkUnevenDistribution } = require('./checkUnevenDistribution');

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–∞–º–∏
const createTeamManagementButtons = (GlobalState) => {
  const isTableAllowed = GlobalState.getIsTableAllowed();
  const playingTeams = GlobalState.getPlayingTeams();
  const teams = GlobalState.getTeams();
  const buttons = [];

  if (isTableAllowed) {
    // –ï—Å–ª–∏ —Å–æ—Å—Ç–∞–≤—ã –æ–±—ä—è–≤–ª–µ–Ω—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã–±–æ—Ä–∞ –∫–æ–º–∞–Ω–¥
    buttons.push([Markup.button.callback('üéØ –í—ã–±—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –º–∞—Ç—á–∞', 'select_teams_callback')]);
  } else {
    // –ï—Å–ª–∏ —Å–æ—Å—Ç–∞–≤—ã –Ω–µ –æ–±—ä—è–≤–ª–µ–Ω—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã–±–æ—Ä–∞ –∫–æ–º–∞–Ω–¥ (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—É—é) –∏ –∫–Ω–æ–ø–∫—É –æ–±—ä—è–≤–ª–µ–Ω–∏—è
    buttons.push([Markup.button.callback('üéØ –í—ã–±—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –º–∞—Ç—á–∞', 'select_teams_blocked')]);
    buttons.push([Markup.button.callback('üì¢ –û–±—ä—è–≤–∏—Ç—å —Å–æ—Å—Ç–∞–≤—ã', 'announce_teams')]);
  }

  // –ö–Ω–æ–ø–∫–∞ "–°–º–µ–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –∫–æ–≥–¥–∞ –º–∞—Ç—á –Ω–µ –∏–¥–µ—Ç (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç isTableAllowed)
  if (!playingTeams) {
    buttons.push([Markup.button.callback('üîÑ –°–º–µ–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞', 'change_player_callback')]);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏
    if (Array.isArray(teams) && teams.length > 0) {
      const distribution = checkUnevenDistribution(teams);
      if (distribution.isUneven) {
        buttons.push([Markup.button.callback('‚ÜîÔ∏è –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∏–≥—Ä–æ–∫–∞', 'move_player_callback')]);
      }
    }
  }

  return Markup.inlineKeyboard(buttons).reply_markup;
};

module.exports = { createTeamManagementButtons };
