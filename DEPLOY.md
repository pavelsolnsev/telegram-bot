# Инструкция по настройке автоматического деплоя

## Настройка GitHub Secrets

Для работы автоматического деплоя необходимо добавить следующие секреты в настройках GitHub репозитория:

1. Перейдите в Settings → Secrets and variables → Actions
2. Добавьте следующие секреты:

### VPS_HOST
**Адрес вашего VPS сервера**

Из данных подключения Beget используйте:
- **External IP**: `217.114.12.13` (это и есть ваш хост)

Или если у вас есть доменное имя, можно использовать его.

**В секрет VPS_HOST добавьте:** `217.114.12.13`

### VPS_USER
**Имя пользователя для SSH подключения**

Из данных подключения: `root@217.114.12.13`
- **Имя пользователя:** `root`

**В секрет VPS_USER добавьте:** `root`

### VPS_SSH_KEY
**Приватный SSH ключ для подключения к серверу**

**Как получить приватный SSH ключ:**

#### Вариант 1: Если у вас уже есть SSH ключ на локальной машине
1. Найдите файл приватного ключа (обычно находится в `~/.ssh/`):
   - `~/.ssh/id_rsa` (старый формат)
   - `~/.ssh/id_ed25519` (современный формат)
   - `~/.ssh/id_ecdsa`

2. Откройте файл и скопируйте **ВСЁ содержимое** (включая строки `-----BEGIN ... KEY-----` и `-----END ... KEY-----`)

3. Добавьте это содержимое в секрет `VPS_SSH_KEY` в GitHub

#### Вариант 2: Если ключа нет, создайте новый
1. На вашей локальной машине выполните:
   ```bash
   ssh-keygen -t ed25519 -C "github-actions-deploy"
   ```
   - Нажмите Enter для сохранения в стандартное место (`~/.ssh/id_ed25519`)
   - Можно оставить пароль пустым (просто Enter) или задать пароль

2. Скопируйте содержимое приватного ключа:
   ```bash
   # Windows (PowerShell)
   Get-Content ~/.ssh/id_ed25519
   
   # Linux/Mac
   cat ~/.ssh/id_ed25519
   ```

3. Скопируйте **ВСЁ содержимое** файла (включая строки `-----BEGIN ... KEY-----` и `-----END ... KEY-----`)

4. Добавьте это содержимое в секрет `VPS_SSH_KEY` в GitHub

5. **Важно:** Добавьте публичный ключ на VPS сервер:
   ```bash
   # Подключитесь к VPS через SSH
   ssh root@217.114.12.13
   
   # Создайте директорию .ssh если её нет
   mkdir -p ~/.ssh
   chmod 700 ~/.ssh
   
   # Добавьте публичный ключ (скопируйте содержимое ~/.ssh/id_ed25519.pub с локальной машины)
   echo "ваш_публичный_ключ_здесь" >> ~/.ssh/authorized_keys
   chmod 600 ~/.ssh/authorized_keys
   ```

### VPS_PROJECT_PATH
**Полный путь к директории проекта на VPS сервере**

**Как определить путь:**

1. Подключитесь к VPS через SSH:
   ```bash
   ssh root@217.114.12.13
   ```

2. Перейдите в директорию, где находится ваш проект:
   ```bash
   cd /путь/к/вашему/проекту
   ```

3. Узнайте текущий путь:
   ```bash
   pwd
   ```
   
   Примеры путей:
   - `/root/telegram-bot`
   - `/var/www/telegram-bot`
   - `/home/telegram-bot`
   - `/opt/telegram-bot`

4. Убедитесь, что это git репозиторий:
   ```bash
   git remote -v
   ```
   
   Должен показать ваш GitHub репозиторий

5. **В секрет VPS_PROJECT_PATH добавьте:** путь, который показал `pwd` (например: `/root/telegram-bot`)

## Как это работает

1. При каждом push в ветку `master` на GitHub
2. GitHub Actions автоматически подключается к вашему VPS серверу через SSH
3. Выполняет `git pull origin master` в директории проекта
4. Обновление кода происходит автоматически

## Проверка настройки

После добавления всех секретов, проверьте подключение:

1. Сделайте небольшое изменение в коде
2. Закоммитьте и запушьте в master:
   ```bash
   git add .
   git commit -m "test deploy"
   git push origin master
   ```
3. Перейдите в GitHub → Actions и проверьте, что workflow выполнился успешно
4. На VPS сервере проверьте, что код обновился:
   ```bash
   ssh root@217.114.12.13
   cd /ваш/путь/к/проекту
   git log -1  # Должен показать последний коммит
   ```

## Важно

- Убедитесь, что на VPS сервере настроен git и есть доступ к репозиторию
- Перезапуск бота и установка зависимостей выполняются вручную на VPS сервере
- Этот workflow только обновляет код через `git pull`
- Если возникают проблемы с подключением, проверьте:
  - Правильность IP адреса и имени пользователя
  - Что SSH ключ добавлен правильно (включая все строки)
  - Что публичный ключ добавлен в `~/.ssh/authorized_keys` на VPS
  - Что путь к проекту указан правильно

